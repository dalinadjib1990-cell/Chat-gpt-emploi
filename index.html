<!doctype html>
<html lang="ar">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>مولّد مذكرات — اضغط زر واصدر مذكرة باسمك</title>

  <!-- Dependencies -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
  <script id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>

  <style>
    :root{ --accent:#0b66a0; --muted:#65707a; --bg:#f5f8fb; --paper:#fff; }
    body{ font-family: "Segoe UI", Tahoma, "Noto Naskh Arabic", Arial; direction: rtl; background:var(--bg); margin:0; padding:18px; color:#111; }
    .app{ max-width:1100px; margin:0 auto; display:flex; gap:18px; }
    .panel{ background:var(--paper); padding:14px; border-radius:10px; box-shadow:0 6px 18px rgba(15,30,45,0.06); }
    .left{ width:380px; flex:0 0 380px; }
    .right{ flex:1; }
    h1{ margin:0 0 8px 0; color:var(--accent); font-size:20px; }
    label{ display:block; margin:10px 0 6px; font-weight:700; }
    input[type=text], select { width:100%; padding:8px; border:1px solid #e1e9f2; border-radius:8px; box-sizing:border-box; }
    .btn{ display:inline-block; background:var(--accent); color:#fff; padding:10px 12px; border-radius:8px; border:none; cursor:pointer; margin-top:10px; }
    .btn-ghost{ background:transparent; border:1px solid #e1e9f2; color:#222; }
    .small{ font-size:13px; color:var(--muted); margin-top:8px; }
    #book{ background:var(--paper); padding:18mm; color:#111; box-shadow:0 6px 18px rgba(0,0,0,0.12); min-height:297mm; width:210mm; margin:10px auto; }
    .cover{ text-align:center; padding-top:22mm; padding-bottom:12mm; }
    .cover h2{ font-size:34px; color:var(--accent); margin:0; }
    .toc{ margin-top:12mm; margin-bottom:12mm; }
    .lessonPage{ page-break-after: always; margin-bottom:6mm; }
    .lessonHeader{ display:flex; justify-content:space-between; align-items:center; border-bottom:3px solid var(--accent); padding-bottom:6px; margin-bottom:10px; }
    .section{ border-left:6px solid var(--accent); background:#fbfeff; padding:10px; margin-bottom:8px; border-radius:4px; }
    img.content-img{ max-width:100%; height:auto; border:1px solid #ddd; margin-top:8px; }
    .controls-row{ display:flex; gap:8px; margin-top:8px; flex-wrap:wrap; }
    @media (max-width:900px){
      .app{ flex-direction:column; }
      .left{ width:auto; }
      #book{ width:100%; padding:12px; box-shadow:none; }
    }
  </style>
</head>
<body>

  <div class="app">
    <div class="panel left">
      <h1>مولّد المذكرة — سهل للأستاذ</h1>

      <label>اسم الأستاذ (سيظهر على الغلاف)</label>
      <input id="teacher" type="text" placeholder="مثلاً: الأستاذ: د. محمد علي" value="الأستاذ: د. اسمك هنا" />

      <label>اسم المؤسسة / المتوسطة</label>
      <input id="school" type="text" placeholder="مثلاً: متوسطة النجاح — 2025" value="متوسطة — 2025" />

      <label>اختر المستوى</label>
      <select id="levelSelect"></select>

      <label>اختر الدرس</label>
      <select id="lessonSelect" size="8" style="height:220px;"></select>

      <div class="controls-row">
        <button id="generateLesson" class="btn">توليد مذكرة هذا الدرس</button>
        <button id="generateLevel" class="btn">توليد جميع دروس هذا المستوى</button>
        <button id="generateAll" class="btn btn-ghost">توليد كامل المستويات</button>
      </div>

      <div class="small">يمكنك تعديل نص أي درس لاحقاً داخل مربع التحرير إن رغبت — لكن الهدف: بضغطة زر تنتج مذكرة جاهزة باسمك.</div>
    </div>

    <div class="panel right">
      <div id="book"></div>
    </div>
  </div>

<script>
/* ===========================
   قاعدة الدروس (معبأة مبدئياً)
   هذه القاعدة قابلة للتعديل داخل الملف لاحقًا.
   ضع هنا عناوين الدروس كما في المنهاج الرسمي إن رغبت.
   =========================== */

const curriculum = {
  "1 متوسط": [
    { id:"1-1", title:"الأعداد الطبيعية والعمليات الأساسية", desc:"مراجعة الأعداد الطبيعية، جمع وطرح وضرب وقسمة، ترتيب الأعداد.", examples:"مثال: 12+8=20\nمثال: 5×6=30", exercises:"1) احسب: 15-7\n2) احسب: 6×7", solutions:"حل1: 8\nحل2:42" },
    { id:"1-2", title:"الأعداد العشرية والكسور البسيطة", desc:"الكتابة العشرية، تحويل الكسر إلى عدد عشري والعكس.", examples:"مثال: \\(\\frac{3}{4}=0.75\\)\nمثال: 0.2=\\(\\frac{1}{5}\\)", exercises:"1) حول 0.6 إلى كسر\n2) اختصر \\(\\frac{6}{9}\\)", solutions:"حل1: \\(\\frac{3}{5}\\)\nحل2: \\(\\frac{2}{3}\\)" },
    { id:"1-3", title:"المجموعات البسيطة والتناظر المحوري", desc:"تعريف المجموعة والتناظر المحوري.", examples:"نشاط: انعكس شكل عبر محور.", exercises:"1) ارسم تناظر محوري لشكل بسيط", solutions:"حل: إظهار الرسم" },
    { id:"1-4", title:"الهندسة البسيطة: النقطة والمستقيم والقطعة", desc:"تعريفات أساسية وطرق القياس.", examples:"مثال: رسم قطعة طولها 5 سم", exercises:"1) ارسم مستقيمًا وقطعًا", solutions:"تعريفات" }
  ],

  "2 متوسط": [
    { id:"2-1", title:"المعادلات من الدرجة الأولى", desc:"حل المعادلات البسيطة \\(ax+b=0\\).", examples:"مثال: حل \\(2x+3=11\\).", exercises:"1) حل: \\(3x+4=13\\)\n2) حل: \\(5x-10=0\\)", solutions:"حل1: x=3\nحل2: x=2" },
    { id:"2-2", title:"الكسور والعمليات عليها", desc:"جمع وطرح وضرب وقسمة الكسور.", examples:"مثال: \\(\\frac{2}{3}+\\frac{1}{6}\\).", exercises:"1) اجمع \\(\\frac{5}{6}+\\frac{1}{3}\\)", solutions:"حل: \\(\\frac{7}{6}\\)" },
    { id:"2-3", title:"الهندسة: الزوايا والمستقيمات المتوازية", desc:"تعريف الزوايا وأنواعها، المستقيمات المتوازية.", examples:"مثال: إذا كانت زاوية 40° المتكاملة لها 140°.", exercises:"1) اذكر نوع الزاوية 120°", solutions:"حل: منفرجة" }
  ],

  "3 متوسط": [
    { id:"3-1", title:"المتتابعات (مقدمة)", desc:"التعرف على المتتابعات الحسابية والهندسية وصيغ الحد العام.", examples:"مثال: متتابعة حسابية فرقها 3: 2,5,8,...", exercises:"1) جد الحد الخامس لمتتابعة تبدأ ب2 فرق3", solutions:"حل: 14" },
    { id:"3-2", title:"الدوال الخطية والتمثيل البياني", desc:"معادلة المستقيم \\(y=mx+c\\) وتمثيلها.", examples:"مثال: ميل المستقيم المار بنقطتين", exercises:"1) جد الميل بين (1,2) و (3,6)", solutions:"حل: 2" }
  ],

  "4 متوسط": [
    { id:"4-1", title:"الدوال والتناسبية", desc:"تعريف الدالة الخطية والتناسبية وتمثيلها.", examples:"مثال: \\(y=2x+1\\) تمثيلها.", exercises:"1) ارسم الدالة \\(y=2x+1\\)", solutions:"حل: تمثيل بياني" },
    { id:"4-2", title:"الإحصاء والاحتمالات الأساسية", desc:"المتوسط، الوسيط، وحساب احتمال بسيط.", examples:"مثال: احتمال الحصول على وجه في رمية عملة = \\(\\frac{1}{2}\\).", exercises:"1) ما احتمال سحب كرة حمراء؟", solutions:"حل: يعتمد على عدد الكرات" }
  ]
};

/* ===========================
   بداية وظائف الواجهة
   =========================== */

const levelSelect = document.getElementById('levelSelect');
const lessonSelect = document.getElementById('lessonSelect');
const teacherInput = document.getElementById('teacher');
const schoolInput = document.getElementById('school');
const bookDiv = document.getElementById('book');

function populateLevels(){
  levelSelect.innerHTML = '';
  Object.keys(curriculum).forEach(lv => {
    const opt = document.createElement('option');
    opt.value = lv; opt.textContent = lv;
    levelSelect.appendChild(opt);
  });
}
function populateLessonsFor(level){
  lessonSelect.innerHTML = '';
  const arr = curriculum[level] || [];
  arr.forEach(d => {
    const opt = document.createElement('option');
    opt.value = d.id; opt.textContent = d.title;
    lessonSelect.appendChild(opt);
  });
}

// Build a single-lesson book HTML
function buildBookForLessons(lessonsArray, levelLabel){
  const teacher = escapeHTML(teacherInput.value || '');
  const school = escapeHTML(schoolInput.value || '');
  let html = '';
  // cover
  html += `<div class="cover lessonPage"><h2>مذكرة رياضيات</h2><div style="margin-top:8px;color:var(--muted);font-size:16px">${escapeHTML(levelLabel)}</div><div style="margin-top:12px;font-size:16px">${school}</div><div style="margin-top:20px;font-size:16px">${teacher}</div></div>`;
  // toc
  html += `<div class="toc lessonPage"><h3>فهرس المحتويات</h3><ol>`;
  lessonsArray.forEach((ls, i) => html += `<li>${escapeHTML((i+1)+'. '+ls.title)}</li>`);
  html += `</ol></div>`;
  // lessons pages
  lessonsArray.forEach((ls, idx) => {
    html += `<div class="lessonPage">`;
    html += `<div class="lessonHeader"><div><h3>${escapeHTML((idx+1)+'. '+ls.title)}</h3></div><div class="small">المستوى: ${escapeHTML(levelLabel)}</div></div>`;
    html += `<div class="section"><strong>الشرح:</strong><div style="margin-top:8px">${nl2br(ls.desc)}</div></div>`;
    if(ls.examples && ls.examples.trim()){
      html += `<div class="section"><strong>أمثلة:</strong><ol>`;
      ls.examples.split(/\n/).filter(s=>s.trim()).forEach(ex => html += `<li>${escapeHTML(ex)}</li>`);
      html += `</ol></div>`;
    }
    if(ls.exercises && ls.exercises.trim()){
      html += `<div class="section"><strong>تمارين:</strong><ol>`;
      ls.exercises.split(/\n/).filter(s=>s.trim()).forEach(q => html += `<li>${escapeHTML(q)}</li>`);
      html += `</ol></div>`;
    }
    if(ls.solutions && ls.solutions.trim()){
      html += `<div class="section"><strong>حلول قصيرة:</strong><div style="margin-top:6px">${nl2br(ls.solutions)}</div></div>`;
    }
    html += `</div>`;
  });
  // footer
  html += `<div class="lessonPage" style="text-align:center;padding-top:40px;"><div class="small">مولّد مذكرات — ${new Date().getFullYear()}</div></div>`;
  return html;
}

function escapeHTML(s){ if(!s) return ''; return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/"/g,'&quot;'); }
function nl2br(s){ if(!s) return ''; return s.replace(/\n/g,'<br/>'); }

// EVENTS
levelSelect.addEventListener('change', ()=> {
  populateLessonsFor(levelSelect.value);
});
document.getElementById('generateLesson').addEventListener('click', ()=> {
  const lvl = levelSelect.value;
  const lid = lessonSelect.value;
  const arr = curriculum[lvl] || [];
  const ls = arr.find(x => x.id === lid);
  if(!ls){ alert('اختر درساً من القائمة'); return; }
  const html = buildBookForLessons([ls], lvl);
  bookDiv.innerHTML = html;
  MathJax.typesetPromise();
  // generate PDF immediately after small delay to allow MathJax render
  setTimeout(()=> exportBookToPdf(html, `${ls.title}.pdf`), 900);
});
document.getElementById('generateLevel').addEventListener('click', ()=> {
  const lvl = levelSelect.value;
  const arr = curriculum[lvl] || [];
  if(arr.length===0){ alert('لا توجد دروس لهذا المستوى'); return; }
  const html = buildBookForLessons(arr, lvl);
  bookDiv.innerHTML = html;
  MathJax.typesetPromise();
  setTimeout(()=> exportBookToPdf(html, `${lvl} - مذكرات.pdf`), 1200);
});
document.getElementById('generateAll').addEventListener('click', ()=> {
  // combine all levels sequentially
  const levels = Object.keys(curriculum);
  let big = '';
  levels.forEach(lv => {
    const arr = curriculum[lv] || [];
    big += buildBookForLessons(arr, lv);
  });
  bookDiv.innerHTML = big;
  MathJax.typesetPromise();
  setTimeout(()=> exportBookToPdf(big, `مذكرات_الرياضيات_المتوسط.pdf`), 1600);
});

// Export using html2pdf
function exportBookToPdf(htmlContent, filename){
  // create a hidden container to feed html2pdf (avoid UI elements)
  const container = document.createElement('div');
  container.style.background = 'white';
  container.innerHTML = htmlContent;
  // ensure element is in DOM for images/fonts to load
  document.body.appendChild(container);
  const opt = {
    margin:       [12,10,12,10],
    filename:     filename,
    image:        { type: 'jpeg', quality: 0.98 },
    html2canvas:  { scale:2, useCORS:true },
    jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' }
  };
  html2pdf().set(opt).from(container).save().then(()=> {
    // cleanup
    document.body.removeChild(container);
  }).catch(err=>{
    alert('حدث خطأ أثناء توليد الـPDF: '+err.message);
    document.body.removeChild(container);
  });
}

/* INIT */
populateLevels();
populateLessonsFor(Object.keys(curriculum)[0]);

</script>

</body>
</html>
